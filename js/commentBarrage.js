var hotreview={switchCommentBarrage:function(){document.querySelector(".comment-barrage")&&($(".comment-barrage").is(":visible")?($(".comment-barrage").hide(),$(".menu-commentBarrage-text").text("显示热评"),document.querySelector("#consoleCommentBarrage").classList.remove("on"),localStorage.setItem("commentBarrageSwitch","false")):$(".comment-barrage").is(":hidden")&&($(".comment-barrage").show(),$(".menu-commentBarrage-text").text("关闭热评"),document.querySelector("#consoleCommentBarrage").classList.add("on"),localStorage.removeItem("commentBarrageSwitch"))),rm.hideRightMenu()},scrollTo:function(e){const t=document.getElementById(e);if(t){const e=t.getBoundingClientRect().top+window.pageYOffset-80,r=window.pageYOffset,a=e-r;let n=null;window.requestAnimationFrame((function e(t){n||(n=t);const o=t-n,m=(i=Math.min(o/0,1))<.5?2*i*i:(4-2*i)*i-1;var i;window.scrollTo(0,r+a*m),o<600&&window.requestAnimationFrame(e)}))}}},postCommentElement=document.getElementById("post-comment");if(postCommentElement){var commentBarrageConfig={maxBarrage:1,barrageTime:4e3,twikooUrl:"https://twikoo.jessaybluck.cf",accessToken:"prj_92SfgsNRPbXIVUmT91AUBk1b6sX3",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,dom:document.querySelector(".comment-barrage")},commentInterval=null,hoverOnCommentBarrage=!1;function initCommentBarrage(){var e=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":commentBarrageConfig.accessToken,url:commentBarrageConfig.pageUrl}),t=new XMLHttpRequest;t.withCredentials=!0,t.addEventListener("readystatechange",(function(){4===this.readyState&&(commentBarrageConfig.barrageList=commentLinkFilter(JSON.parse(this.responseText).data),commentBarrageConfig.dom.innerHTML="")})),t.open("POST",commentBarrageConfig.twikooUrl),t.setRequestHeader("Content-Type","application/json"),t.send(e),clearInterval(commentInterval),commentInterval=null,commentInterval=setInterval((()=>{commentBarrageConfig.barrageList.length&&!hoverOnCommentBarrage&&(popCommentBarrage(commentBarrageConfig.barrageList[commentBarrageConfig.barrageIndex]),commentBarrageConfig.barrageIndex+=1,commentBarrageConfig.barrageIndex%=commentBarrageConfig.barrageList.length),commentBarrageConfig.barrageTimer.length>(commentBarrageConfig.barrageList.length>commentBarrageConfig.maxBarrage?commentBarrageConfig.maxBarrage:commentBarrageConfig.barrageList.length)&&!hoverOnCommentBarrage&&removeCommentBarrage(commentBarrageConfig.barrageTimer.shift())}),commentBarrageConfig.barrageTime)}function commentLinkFilter(e){e.sort(((e,t)=>e.created-t.created));let t=[];return e.forEach((e=>{t.push(...getCommentReplies(e))})),t}function getCommentReplies(e){if(e.replies){let t=[e];return e.replies.forEach((e=>{t.push(...getCommentReplies(e))})),t}return[]}function popCommentBarrage(e){let t=document.createElement("div");commentBarrageConfig.dom.clientWidth,commentBarrageConfig.dom.clientHeight;t.className="comment-barrage-item",t.innerHTML=`\n\t\t<div class="barrageHead">\n      \t\t<a class="barrageTitle" href="javascript:hotreview.scrollTo('post-comment')"">热评</a>\n\t\t\t<div class="barrageNick">${e.nick}</div>\n\t\t\t<img class="barrageAvatar" src="https://cravatar.cn/avatar/${e.mailMd5}"/>\n\t\t\t<a class="comment-barrage-close" href="javascript:hotreview.switchCommentBarrage()"><i class="iconfont icat-close"></i></a>\n\t\t</div>\n\t\t<a class="barrageContent" href="javascript:hotreview.scrollTo('${e.id}');">${e.comment}</a>\n\t`,commentBarrageConfig.barrageTimer.push(t),commentBarrageConfig.dom.append(t)}function removeCommentBarrage(e){e.className="comment-barrage-item out",setTimeout((()=>{commentBarrageConfig.dom.removeChild(e)}),1e3)}$(".comment-barrage").hover((function(){hoverOnCommentBarrage=!0,console.log("热评悬浮")}),(function(){hoverOnCommentBarrage=!1,console.log("停止悬浮")})),document.addEventListener("scroll",btf.throttle((function(){var e=window.scrollY+document.documentElement.clientHeight,t=(window.scrollY,document.querySelector(".comment-barrage")),r=document.getElementById("post-comment");if(r&&t){var a=r.offsetTop+r.offsetHeight/2;document.body.clientWidth>768&&(t.style.bottom=a>e?"40px":"-200px")}}),200)),initCommentBarrage(),document.addEventListener("pjax:send",(function(){clearInterval(commentInterval)}))}